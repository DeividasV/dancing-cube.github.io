<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Deformed Sinusoidal Coordinate System</title>
    <style>
      body {
        margin: 0;
        padding: 20px;
        background: #f5f5f5;
        font-family: Arial, sans-serif;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      canvas {
        border: 1px solid #ddd;
        border-radius: 5px;
      }
      h1 {
        text-align: center;
        color: #333;
        margin-bottom: 20px;
      }
      .controls {
        text-align: center;
        margin-top: 20px;
      }
      button {
        background: #4caf50;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
        font-size: 14px;
      }
      button:hover {
        background: #45a049;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Deformed Sinusoidal Coordinate System</h1>
      <canvas id="canvas" width="760" height="600"></canvas>
      <div class="controls">
        <button onclick="regenerateAxes()">Generate New Random Axes</button>
        <button onclick="toggleAnimation()">Toggle Animation</button>
      </div>
    </div>

    <script>
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");
      const width = canvas.width;
      const height = canvas.height;
      const centerX = width / 2;
      const centerY = height / 2;

      let animationId;
      let isAnimating = false;
      let time = 0;

      // Random parameters for sinusoidal deformation (increased amplitude for more dramatic bending)
      let xAxisParams = {
        freq1: Math.random() * 0.015 + 0.008,
        freq2: Math.random() * 0.012 + 0.005,
        amp1: Math.random() * 50 + 20,
        amp2: Math.random() * 35 + 10,
        phase1: Math.random() * Math.PI * 2,
        phase2: Math.random() * Math.PI * 2,
      };

      let yAxisParams = {
        freq1: Math.random() * 0.015 + 0.008,
        freq2: Math.random() * 0.012 + 0.005,
        amp1: Math.random() * 50 + 20,
        amp2: Math.random() * 35 + 10,
        phase1: Math.random() * Math.PI * 2,
        phase2: Math.random() * Math.PI * 2,
      };

      function deformPoint(x, y, t = 0) {
        // X-axis bending (affects y-coordinate of horizontal movements)
        const xBendY =
          xAxisParams.amp1 *
            Math.sin(x * xAxisParams.freq1 + xAxisParams.phase1 + t * 0.02) +
          xAxisParams.amp2 *
            Math.sin(x * xAxisParams.freq2 + xAxisParams.phase2 + t * 0.03);

        // Y-axis bending (affects x-coordinate of vertical movements)
        const yBendX =
          yAxisParams.amp1 *
            Math.sin(y * yAxisParams.freq1 + yAxisParams.phase1 + t * 0.025) +
          yAxisParams.amp2 *
            Math.sin(y * yAxisParams.freq2 + yAxisParams.phase2 + t * 0.02);

        return {
          x: x + yBendX,
          y: y + xBendY,
        };
      }

      function drawDeformedGrid(t = 0) {
        ctx.clearRect(0, 0, width, height);

        // Create red gradient for filling squares
        const gradient = ctx.createLinearGradient(0, 0, 80, 80);
        gradient.addColorStop(0, "rgba(255, 100, 100, 0.7)");
        gradient.addColorStop(0.5, "rgba(255, 50, 50, 0.5)");
        gradient.addColorStop(1, "rgba(200, 50, 50, 0.3)");

        // Fill every second deformed square with red gradient (adjusted for new grid density)
        for (let i = -15; i <= 14; i++) {
          for (let j = -12; j <= 11; j++) {
            // Checkerboard pattern: fill when (i + j) is even
            if ((i + j) % 2 === 0) {
              ctx.fillStyle = gradient;
              ctx.beginPath();

              // Get the four corners of the square (adjusted spacing)
              const corners = [
                deformPoint(i * 25, j * 20, t),
                deformPoint((i + 1) * 25, j * 20, t),
                deformPoint((i + 1) * 25, (j + 1) * 20, t),
                deformPoint(i * 25, (j + 1) * 20, t),
              ];

              // Draw the deformed square
              ctx.moveTo(corners[0].x + centerX, corners[0].y + centerY);
              ctx.lineTo(corners[1].x + centerX, corners[1].y + centerY);
              ctx.lineTo(corners[2].x + centerX, corners[2].y + centerY);
              ctx.lineTo(corners[3].x + centerX, corners[3].y + centerY);
              ctx.closePath();
              ctx.fill();
            }
          }
        }

        // Draw grid lines
        ctx.strokeStyle = "#e0e0e0";
        ctx.lineWidth = 0.5;

        // Vertical grid lines (bending with the coordinate system) - more dense
        for (let i = -15; i <= 15; i++) {
          const baseX = i * 25; // Reduced spacing for denser grid
          ctx.beginPath();
          for (let j = -18; j <= 18; j++) {
            const baseY = j * 17;
            const deformed = deformPoint(baseX, baseY, t);
            const screenX = deformed.x + centerX;
            const screenY = deformed.y + centerY;

            if (
              screenX >= -100 &&
              screenX <= width + 100 &&
              screenY >= -100 &&
              screenY <= height + 100
            ) {
              if (j === -18) {
                ctx.moveTo(screenX, screenY);
              } else {
                ctx.lineTo(screenX, screenY);
              }
            }
          }
          ctx.stroke();
        }

        // Horizontal grid lines (bending with the coordinate system) - more dense
        for (let i = -15; i <= 15; i++) {
          const baseY = i * 20; // Reduced spacing for denser grid
          ctx.beginPath();
          for (let j = -25; j <= 25; j++) {
            const baseX = j * 15;
            const deformed = deformPoint(baseX, baseY, t);
            const screenX = deformed.x + centerX;
            const screenY = deformed.y + centerY;

            if (
              screenX >= -100 &&
              screenX <= width + 100 &&
              screenY >= -100 &&
              screenY <= height + 100
            ) {
              if (j === -25) {
                ctx.moveTo(screenX, screenY);
              } else {
                ctx.lineTo(screenX, screenY);
              }
            }
          }
          ctx.stroke();
        }

        // Draw main axes with bending
        ctx.strokeStyle = "#ff4444";
        ctx.lineWidth = 4;

        // Bent Y-axis (vertical line through center) - extended for more scale coverage
        ctx.beginPath();
        for (let i = -20; i <= 20; i++) {
          const baseY = i * 15;
          const deformed = deformPoint(0, baseY, t);
          const screenX = deformed.x + centerX;
          const screenY = deformed.y + centerY;

          if (i === -20) {
            ctx.moveTo(screenX, screenY);
          } else {
            ctx.lineTo(screenX, screenY);
          }
        }
        ctx.stroke();

        // Bent X-axis (horizontal line through center) - extended for more scale coverage
        ctx.beginPath();
        for (let i = -25; i <= 25; i++) {
          const baseX = i * 15;
          const deformed = deformPoint(baseX, 0, t);
          const screenX = deformed.x + centerX;
          const screenY = deformed.y + centerY;

          if (i === -25) {
            ctx.moveTo(screenX, screenY);
          } else {
            ctx.lineTo(screenX, screenY);
          }
        }
        ctx.stroke();

        // Draw axis labels
        ctx.fillStyle = "#ff4444";
        ctx.font = "18px Arial";
        ctx.fontWeight = "bold";

        // X-axis label at the end of bent x-axis
        const xEndDeformed = deformPoint(380 - centerX, 0, t);
        ctx.fillText(
          "x",
          xEndDeformed.x + centerX - 10,
          xEndDeformed.y + centerY + 5
        );

        // Y-axis label at the end of bent y-axis
        const yEndDeformed = deformPoint(0, -(300 - centerY), t);
        ctx.fillText(
          "y",
          yEndDeformed.x + centerX - 8,
          yEndDeformed.y + centerY + 5
        );

        // Draw tick marks and numbers along bent axes
        ctx.fillStyle = "#333";
        ctx.font = "12px Arial";
        ctx.textAlign = "center";

        // X-axis ticks along the bent x-axis (25 numbers: -12 to +12)
        for (let i = -12; i <= 12; i++) {
          if (i === 0) continue;
          const baseX = i * 30; // Reduced spacing to fit more numbers
          const deformed = deformPoint(baseX, 0, t);
          const screenX = deformed.x + centerX;
          const screenY = deformed.y + centerY;

          // Only draw if visible on screen
          if (
            screenX >= -50 &&
            screenX <= width + 50 &&
            screenY >= -50 &&
            screenY <= height + 50
          ) {
            // Tick mark perpendicular to the bent axis
            const nextDeformed = deformPoint(baseX + 5, 0, t);
            const dx = nextDeformed.x - deformed.x;
            const dy = nextDeformed.y - deformed.y;
            const length = Math.sqrt(dx * dx + dy * dy);
            const perpX = (-dy / length) * 6;
            const perpY = (dx / length) * 6;

            ctx.strokeStyle = "#333";
            ctx.lineWidth = 1.5;
            ctx.beginPath();
            ctx.moveTo(screenX + perpX, screenY + perpY);
            ctx.lineTo(screenX - perpX, screenY - perpY);
            ctx.stroke();

            // Number with smaller font for better fit
            ctx.fillStyle = "#333";
            ctx.font = "10px Arial";
            ctx.textAlign = "center";
            ctx.fillText(
              i.toString(),
              screenX + perpX * 2,
              screenY + perpY * 2 + 12
            );
          }
        }

        // Y-axis ticks along the bent y-axis (25 numbers: -12 to +12)
        for (let i = -12; i <= 12; i++) {
          if (i === 0) continue;
          const baseY = -i * 23; // Reduced spacing and negative because canvas y increases downward
          const deformed = deformPoint(0, baseY, t);
          const screenX = deformed.x + centerX;
          const screenY = deformed.y + centerY;

          // Only draw if visible on screen
          if (
            screenX >= -50 &&
            screenX <= width + 50 &&
            screenY >= -50 &&
            screenY <= height + 50
          ) {
            // Tick mark perpendicular to the bent axis
            const nextDeformed = deformPoint(0, baseY + 5, t);
            const dx = nextDeformed.x - deformed.x;
            const dy = nextDeformed.y - deformed.y;
            const length = Math.sqrt(dx * dx + dy * dy);
            const perpX = (-dy / length) * 6;
            const perpY = (dx / length) * 6;

            ctx.strokeStyle = "#333";
            ctx.lineWidth = 1.5;
            ctx.beginPath();
            ctx.moveTo(screenX + perpX, screenY + perpY);
            ctx.lineTo(screenX - perpX, screenY - perpY);
            ctx.stroke();

            // Number with smaller font for better fit
            ctx.fillStyle = "#333";
            ctx.font = "10px Arial";
            ctx.textAlign = "center";
            ctx.fillText(
              i.toString(),
              screenX - perpX * 2 - 12,
              screenY - perpY * 2 + 4
            );
          }
        }

        // Draw origin
        const originDeformed = deformPoint(0, 0, t);
        const originX = originDeformed.x + centerX;
        const originY = originDeformed.y + centerY;
        ctx.fillStyle = "#ff4444";
        ctx.beginPath();
        ctx.arc(originX, originY, 6, 0, Math.PI * 2);
        ctx.fill();
        ctx.strokeStyle = "#fff";
        ctx.lineWidth = 2;
        ctx.stroke();
        ctx.fillStyle = "#333";
        ctx.font = "14px Arial";
        ctx.fontWeight = "bold";
        ctx.fillText("0", originX - 20, originY + 25);
      }

      function animate() {
        if (isAnimating) {
          drawDeformedGrid(time);
          time += 1;
          animationId = requestAnimationFrame(animate);
        }
      }

      function regenerateAxes() {
        xAxisParams = {
          freq1: Math.random() * 0.02 + 0.005,
          freq2: Math.random() * 0.015 + 0.003,
          amp1: Math.random() * 30 + 10,
          amp2: Math.random() * 20 + 5,
          phase1: Math.random() * Math.PI * 2,
          phase2: Math.random() * Math.PI * 2,
        };

        yAxisParams = {
          freq1: Math.random() * 0.02 + 0.005,
          freq2: Math.random() * 0.015 + 0.003,
          amp1: Math.random() * 30 + 10,
          amp2: Math.random() * 20 + 5,
          phase1: Math.random() * Math.PI * 2,
          phase2: Math.random() * Math.PI * 2,
        };

        drawDeformedGrid(time);
      }

      function toggleAnimation() {
        isAnimating = !isAnimating;
        if (isAnimating) {
          animate();
        } else {
          cancelAnimationFrame(animationId);
        }
      }

      // Initial draw
      drawDeformedGrid();
    </script>
  </body>
</html>
