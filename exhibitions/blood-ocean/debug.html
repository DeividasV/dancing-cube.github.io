<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Blood Ocean Debug</title>
    <style>
      body {
        margin: 0;
        background: #000;
      }
      canvas {
        display: block;
        width: 100vw;
        height: 100vh;
      }
      .debug {
        position: absolute;
        top: 10px;
        left: 10px;
        color: white;
        font-family: monospace;
      }
    </style>
  </head>
  <body>
    <canvas id="canvas"></canvas>
    <div class="debug">Debug Mode - Check console for errors</div>

    <script>
      // Minimal test to isolate the color issue
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");

      // Test color mixing function
      function testColorMixing() {
        try {
          console.log("Testing color mixing...");

          // Test the problematic function
          const baseColor = "#8b0000";
          const envTint = { r: 0.1, g: 0.15, b: 0.2 };

          const mixEnvColorWithAlpha = (baseColor, envIntensity, alpha) => {
            const r = parseInt(baseColor.slice(1, 3), 16);
            const g = parseInt(baseColor.slice(3, 5), 16);
            const b = parseInt(baseColor.slice(5, 7), 16);

            const mixedR = Math.round(
              r * (1 - envTint.r) + 255 * envTint.r * envIntensity
            );
            const mixedG = Math.round(
              g * (1 - envTint.g) + 255 * envTint.g * envIntensity
            );
            const mixedB = Math.round(
              b * (1 - envTint.b) + 255 * envTint.b * envIntensity
            );

            return `rgba(${mixedR}, ${mixedG}, ${mixedB}, ${alpha})`;
          };

          const testColor = mixEnvColorWithAlpha(baseColor, 0.3, 0.5);
          console.log("Test color result:", testColor);

          // Test gradient with the result
          const gradient = ctx.createRadialGradient(50, 50, 0, 50, 50, 100);
          gradient.addColorStop(0, testColor);
          gradient.addColorStop(1, "#000000");

          ctx.fillStyle = gradient;
          ctx.fillRect(0, 0, 100, 100);

          console.log("Color mixing test passed!");
          return true;
        } catch (error) {
          console.error("Color mixing test failed:", error);
          return false;
        }
      }

      function resizeCanvas() {
        const dpr = Math.max(1, window.devicePixelRatio || 1);
        canvas.width = Math.floor(window.innerWidth * dpr);
        canvas.height = Math.floor(window.innerHeight * dpr);
        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
      }

      resizeCanvas();
      window.addEventListener("resize", resizeCanvas);

      // Run test
      if (testColorMixing()) {
        console.log("✅ Color system working correctly");
      } else {
        console.log("❌ Color system has issues");
      }

      // Simple animation test
      let frame = 0;
      function animate() {
        frame++;

        try {
          ctx.fillStyle = "#000";
          ctx.fillRect(
            0,
            0,
            canvas.width / window.devicePixelRatio,
            canvas.height / window.devicePixelRatio
          );

          ctx.fillStyle = `hsl(${frame % 360}, 50%, 50%)`;
          ctx.fillRect(50, 50, 100, 100);

          if (frame % 60 === 0) {
            console.log(`Frame ${frame} rendered successfully`);
          }
        } catch (error) {
          console.error("Animation error at frame", frame, ":", error);
        }

        requestAnimationFrame(animate);
      }

      animate();
    </script>
  </body>
</html>
